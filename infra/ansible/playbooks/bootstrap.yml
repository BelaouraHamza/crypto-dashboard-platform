- name: Bootstrap local Kubernetes cluster with TLS and ArgoCD
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:

    # === Installer les collections nécessaires ===
    - name: Install required Ansible collections
      ansible.builtin.block:
        - name: Install community.crypto collection
          ansible.builtin.ansible_galaxy:
            command: collection
            name: community.crypto
            state: present

        - name: Install community.kubernetes collection
          ansible.builtin.ansible_galaxy:
            command: collection
            name: community.kubernetes
            state: present

    # === Appel des rôles ===
    - name: Apply TLS, Cluster and Deploy roles
      ansible.builtin.include_role:
        name: tls

    - name: Apply Cluster role
      ansible.builtin.include_role:
        name: cluster

    - name: Apply Deploy role
      ansible.builtin.include_role:
        name: deploy
